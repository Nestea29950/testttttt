"use strict";(self.webpackChunkstrapi_sqlite=self.webpackChunkstrapi_sqlite||[]).push([[4263],{64797:function(e,t,a){var r=a(25108),n=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(a(67154)),l=n(a(53547)),s=a(39711),i=a(97132),u=n(a(45697)),d=n(a(78718)),c=n(a(27361)),f=n(a(57557)),p=a(68547),m=a(23724),g=a(80831),v=a(94117),y=a(64459),b=a(39272),h=a(35395),w=a(56156),E=a(33483),M=a(80117),k=a(9524),O=n(a(87760)),P=n(a(22754)),j=a(26595),_=a(50289),A=n(a(59015)),L=a(37108),U=n(a(22849));const I=window&&window.strapi&&window.strapi.isEE?a(43685).Z:a(84768).Z,S=["email","firstname","lastname","username","isActive","roles"],T=e=>{let{canUpdate:t}=e;const{formatMessage:a}=(0,i.useIntl)(),{params:{id:n}}=(0,s.useRouteMatch)("/settings/users/:id"),{push:u}=(0,s.useHistory)(),{setUserDisplayName:T}=(0,p.useAppInfos)(),C=(0,p.useNotification)(),{lockApp:x,unlockApp:q}=(0,p.useOverlayBlocker)();(0,p.useFocusWhenNavigate)();const{status:B,data:W}=(0,m.useQuery)(["user",n],(()=>(0,_.fetchUser)(n)),{retry:!1,keepPreviousData:!1,staleTime:2e4,onError:e=>{403===e.response.status&&(C({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),u("/")),r.log(e.response.status)}}),z="success"!==B,D=z?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},R=Object.keys((0,d.default)(W,S)).reduce(((e,t)=>"roles"===t?(e[t]=((null===W||void 0===W?void 0:W.roles)||[]).map((e=>{let{id:t}=e;return t})),e):(e[t]=null===W||void 0===W?void 0:W[t],e)),{}),$=R.username||(0,j.getFullName)(R.firstname,R.lastname),N=a(D,{name:$});return z?l.default.createElement(M.Main,{"aria-busy":"true"},l.default.createElement(p.SettingsPageTitle,{name:"Users"}),l.default.createElement(h.HeaderLayout,{primaryAction:l.default.createElement(y.Button,{disabled:!0,startIcon:l.default.createElement(P.default,null),type:"button",size:"L"},a({id:"global.save",defaultMessage:"Save"})),title:N,navigationAction:l.default.createElement(w.Link,{startIcon:l.default.createElement(O.default,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},a({id:"global.back",defaultMessage:"Back"}))}),l.default.createElement(h.ContentLayout,null,l.default.createElement(p.LoadingIndicatorPage,null))):l.default.createElement(M.Main,null,l.default.createElement(p.SettingsPageTitle,{name:"Users"}),l.default.createElement(g.Formik,{onSubmit:async(e,t)=>{x();try{const r=await(0,_.putUser)(n,(0,f.default)(e,"confirmPassword"));C({type:"success",message:a({id:"notification.success.saved",defaultMessage:"Saved"})});const o=p.auth.getUserInfo();if(n.toString()===o.id.toString()){p.auth.setUserInfo(r);const t=(0,c.default)(e,"username")||(0,j.getFullName)(e.firstname,e.lastname);T(t)}t.setValues((0,d.default)(e,S))}catch(r){const e=(0,j.formatAPIErrors)(r.response.data),a=Object.keys(e).reduce(((t,a)=>(t[a]=e[a].id,t)),{});t.setErrors(a),C({type:"warning",message:(0,c.default)(r,"response.data.message","notification.error")})}q()},initialValues:R,validateOnChange:!1,validationSchema:L.editValidation},(e=>{let{errors:r,values:n,handleChange:s,isSubmitting:i}=e;return l.default.createElement(p.Form,null,l.default.createElement(h.HeaderLayout,{primaryAction:l.default.createElement(y.Button,{disabled:i||!t,startIcon:l.default.createElement(P.default,null),loading:i,type:"submit",size:"L"},a({id:"global.save",defaultMessage:"Save"})),title:N,navigationAction:l.default.createElement(w.Link,{startIcon:l.default.createElement(O.default,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},a({id:"global.back",defaultMessage:"Back"}))}),l.default.createElement(h.ContentLayout,null,(null===W||void 0===W?void 0:W.registrationToken)&&l.default.createElement(v.Box,{paddingBottom:6},l.default.createElement(I,{registrationToken:W.registrationToken})),l.default.createElement(k.Stack,{spacing:7},l.default.createElement(v.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},l.default.createElement(k.Stack,{spacing:4},l.default.createElement(E.Typography,{variant:"delta",as:"h2"},a({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),l.default.createElement(b.Grid,{gap:5},A.default.map((e=>e.map((e=>l.default.createElement(b.GridItem,(0,o.default)({key:e.name},e.size),l.default.createElement(p.GenericInput,(0,o.default)({},e,{disabled:!t,error:r[e.name],onChange:s,value:n[e.name]||""})))))))))),l.default.createElement(v.Box,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},l.default.createElement(k.Stack,{spacing:4},l.default.createElement(E.Typography,{variant:"delta",as:"h2"},a({id:"global.roles",defaultMessage:"User's role"})),l.default.createElement(b.Grid,{gap:5},l.default.createElement(b.GridItem,{col:6,xs:12},l.default.createElement(U.default,{disabled:!t,error:r.roles,onChange:s,value:n.roles}))))))))})))};T.propTypes={canUpdate:u.default.bool.isRequired};var C=T;t.default=C},50289:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.putUser=t.fetchUser=void 0;var r=a(53777);t.fetchUser=async e=>{const{data:t}=await r.axiosInstance.get(`/admin/users/${e}`);return t.data};t.putUser=async(e,t)=>{const{data:a}=await r.axiosInstance.put(`/admin/users/${e}`,t);return a.data}},59015:function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"email",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12}},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]];t.default=a},20262:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=d(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=n?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(a(53547)),o=a(68547),l=a(39711),s=a(96486),i=r(a(13240)),u=r(a(64797));function d(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(d=function(e){return e?a:t})(e)}var c=()=>{const e=(0,o.useNotification)(),t=(0,n.useMemo)((()=>({read:i.default.settings.users.read,update:i.default.settings.users.update})),[]),{isLoading:a,allowedActions:{canRead:r,canUpdate:d}}=(0,o.useRBAC)(t),{state:c}=(0,l.useLocation)(),f=(0,s.get)(c,"from","/");return(0,n.useEffect)((()=>{a||r||d||e({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})}),[a,r,d,e]),a?n.default.createElement(o.LoadingIndicatorPage,null):r||d?n.default.createElement(u.default,{canUpdate:d}):n.default.createElement(l.Redirect,{to:f})};t.default=c},38059:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a(53547)),o=r(a(45697)),l=a(49549),s=a(68547),i=r(a(54279)),u=a(74855),d=a(97132);const c=()=>n.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},n.default.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},n.default.createElement("tspan",{x:"23",y:"36"},"\u2709\ufe0f"))),f=e=>{let{children:t,target:a}=e;const r=(0,s.useNotification)(),{formatMessage:o}=(0,d.useIntl)(),f=o({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return n.default.createElement(s.ContentBox,{endAction:n.default.createElement(u.CopyToClipboard,{onCopy:()=>{r({type:"info",message:{id:"notification.link-copied"}})},text:a},n.default.createElement(l.IconButton,{label:f,noBorder:!0,icon:n.default.createElement(i.default,null)})),title:a,titleEllipsis:!0,subtitle:t,icon:n.default.createElement(c,null),iconBackground:"neutral100"})};f.propTypes={children:o.default.oneOfType([o.default.element,o.default.string]).isRequired,target:o.default.string.isRequired};var p=f;t.default=p},84768:function(e,t,a){var r=a(95318);t.Z=void 0;var n=r(a(53547)),o=a(97132),l=r(a(45697)),s=r(a(92424)),i=r(a(38059));const u=e=>{let{registrationToken:t}=e;const{formatMessage:a}=(0,o.useIntl)(),r=`${window.location.origin}${s.default}auth/register?registrationToken=${t}`;return n.default.createElement(i.default,{target:r},a({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};u.defaultProps={registrationToken:""},u.propTypes={registrationToken:l.default.string};var d=u;t.Z=d},22849:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a(53547)),o=r(a(45697)),l=a(97132),s=a(2632),i=a(23724),u=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=f(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=n?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(a(78384)),d=r(a(79386)),c=a(53777);function f(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(f=function(e){return e?a:t})(e)}const p=(0,u.keyframes)(["from{transform:rotate(0deg);}to{transform:rotate(359deg);}"]),m=u.default.div.withConfig({displayName:"SelectRoles__LoadingWrapper",componentId:"sc-1z5s3s-0"})(["animation:"," 2s infinite linear;"],p),g=()=>n.default.createElement(m,null,n.default.createElement(d.default,null)),v=async()=>{const{data:e}=await c.axiosInstance.get("/admin/roles");return e.data},y=e=>{let{disabled:t,error:a,onChange:r,value:o}=e;const{status:u,data:d}=(0,i.useQuery)(["roles"],v,{staleTime:5e4}),{formatMessage:c}=(0,l.useIntl)(),f=a?c({id:a,defaultMessage:a}):"",p=c({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),m=c({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),y=c({id:"app.components.Select.placeholder",defaultMessage:"Select"}),b="loading"===u?n.default.createElement(g,null):void 0;return n.default.createElement(s.Select,{id:"roles",disabled:t,error:f,hint:m,label:p,name:"roles",onChange:e=>{r({target:{name:"roles",value:e}})},placeholder:y,multi:!0,startIcon:b,value:o,withTags:!0,required:!0},(d||[]).map((e=>n.default.createElement(s.Option,{key:e.id,value:e.id},e.name))))};y.defaultProps={disabled:!1,error:void 0},y.propTypes={disabled:o.default.bool,error:o.default.string,onChange:o.default.func.isRequired,value:o.default.array.isRequired};var b=y;t.default=b},33694:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var l=n?Object.getOwnPropertyDescriptor(e,o):null;l&&(l.get||l.set)?Object.defineProperty(r,o,l):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(a(53209)),o=a(21600),l=r(a(20703));function s(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}var i=n.object().shape({...o.commonUserSchema,isActive:n.bool(),...l.default});t.default=i},37108:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"editValidation",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"profileValidation",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(t,"rolesValidation",{enumerable:!0,get:function(){return l.default}});var n=r(a(33694)),o=r(a(21600)),l=r(a(20703))},21600:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.commonUserSchema=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=o(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=n?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(r,l,s):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(a(53209)),n=a(68547);function o(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:t})(e)}const l={firstname:r.mixed().required(n.translatedErrors.required),lastname:r.mixed(),email:r.string().email(n.translatedErrors.email).lowercase().required(n.translatedErrors.required),username:r.string().nullable(),password:r.string().min(8,n.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:r.string().min(8,n.translatedErrors.minLength).oneOf([r.ref("password"),null],"components.Input.error.password.noMatch").when("password",((e,t)=>e?t.required(n.translatedErrors.required):t))};t.commonUserSchema=l;var s={...l,currentPassword:r.string().when(["password","confirmPassword"],((e,t,a)=>e||t?a.required(n.translatedErrors.required):a)),preferedLanguage:r.string().nullable()};t.default=s},20703:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=o(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var s=n?Object.getOwnPropertyDescriptor(e,l):null;s&&(s.get||s.set)?Object.defineProperty(r,l,s):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(a(53209)),n=a(68547);function o(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(o=function(e){return e?a:t})(e)}var l={roles:r.array().min(1,n.translatedErrors.required).required(n.translatedErrors.required)};t.default=l},43685:function(e,t,a){var r=a(95318);t.Z=void 0;var n=r(a(53547)),o=a(97132),l=r(a(45697)),s=r(a(92424)),i=r(a(38059));const u=e=>{let{registrationToken:t}=e;const{formatMessage:a}=(0,o.useIntl)();return t?n.default.createElement(i.default,{target:`${window.location.origin}${s.default}auth/register?registrationToken=${t}`},a({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):n.default.createElement(i.default,{target:`${window.location.origin}${s.default}auth/login`},a({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};u.defaultProps={registrationToken:""},u.propTypes={registrationToken:l.default.string};var d=u;t.Z=d}}]);