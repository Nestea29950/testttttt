"use strict";(self.webpackChunkstrapi_sqlite=self.webpackChunkstrapi_sqlite||[]).push([[2544],{5790:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(a(53547)),l=a(94117),o=a(39272),i=a(40264),u=a(9524),s=a(33483),d=a(78607),c=a(99136),f=a(64459),p=r(a(45697)),m=a(97132);const g=e=>{let{disabled:t,role:a,values:r,errors:p,onChange:g,onBlur:b}=e;const{formatMessage:y}=(0,m.useIntl)();return n.default.createElement(n.default.Fragment,null,n.default.createElement(l.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},n.default.createElement(u.Stack,{spacing:4},n.default.createElement(i.Flex,{justifyContent:"space-between"},n.default.createElement(l.Box,null,n.default.createElement(l.Box,null,n.default.createElement(s.Typography,{fontWeight:"bold"},a?a.name:y({id:"global.details",defaultMessage:"Details"}))),n.default.createElement(l.Box,null,n.default.createElement(s.Typography,{textColor:"neutral500",variant:"pi"},a?a.description:y({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),n.default.createElement(f.Button,{disabled:!0,variant:"secondary"},y({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:a.usersCount}))),n.default.createElement(o.Grid,{gap:4},n.default.createElement(o.GridItem,{col:6},n.default.createElement(c.TextInput,{disabled:t,name:"name",error:p.name&&y({id:p.name}),label:y({id:"global.name",defaultMessage:"Name"}),onChange:g,onBlur:b,value:r.name||""})),n.default.createElement(o.GridItem,{col:6},n.default.createElement(d.Textarea,{disabled:t,label:y({id:"global.description",defaultMessage:"Description"}),name:"description",error:p.name&&y({id:p.name}),onChange:g,onBlur:b},r.description||""))))))};g.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},g.propTypes={disabled:p.default.bool,errors:p.default.object.isRequired,onBlur:p.default.func.isRequired,onChange:p.default.func.isRequired,role:p.default.object,values:p.default.object};var b=g;t.default=b},4397:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"Permissions",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(t,"RoleForm",{enumerable:!0,get:function(){return l.default}});var n=r(a(74716)),l=r(a(5790))},46781:function(e,t,a){var r=a(25108),n=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var l=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=O(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var o=n?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(r,l,o):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(a(53547)),o=a(68547),i=a(94117),u=a(64459),s=a(35395),d=a(80117),c=a(9524),f=a(80831),p=a(56156),m=n(a(87760)),g=n(a(27361)),b=a(97132),y=a(39711),v=a(4397),h=a(63376),E=n(a(88245));function O(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(O=function(e){return e?a:t})(e)}var P=()=>{const e=(0,o.useNotification)(),{formatMessage:t}=(0,b.useIntl)(),{params:{id:a}}=(0,y.useRouteMatch)("/settings/roles/:id"),[n,O]=(0,l.useState)(!1),P=(0,l.useRef)(),{lockApp:M,unlockApp:j}=(0,o.useOverlayBlocker)(),{trackUsage:w}=(0,o.useTracking)(),{isLoading:k,data:S}=(0,h.useFetchPermissionsLayout)(a),{role:_,permissions:B,isLoading:C,onSubmitSucceeded:R}=(0,h.useFetchRole)(a),L="strapi-super-admin"===_.code;return l.default.createElement(d.Main,null,l.default.createElement(o.SettingsPageTitle,{name:"Roles"}),l.default.createElement(f.Formik,{enableReinitialize:!0,initialValues:{name:_.name,description:_.description},onSubmit:async t=>{try{M(),O(!0);const{permissionsToSend:r,didUpdateConditions:n}=P.current.getPermissions();await(0,o.request)(`/admin/roles/${a}`,{method:"PUT",body:t}),"strapi-super-admin"!==_.code&&(await(0,o.request)(`/admin/roles/${a}/permissions`,{method:"PUT",body:{permissions:r}}),n&&w("didUpdateConditions")),P.current.setFormAfterSubmit(),R({name:t.name,description:t.description}),e({type:"success",message:{id:"notification.success.saved"}})}catch(n){r.error(n.response);const t=(0,g.default)(n,"response.payload.message","An error occured"),a=(0,g.default)(n,"response.payload.data.permissions[0]",t);e({type:"warning",message:a})}finally{O(!1),j()}},validationSchema:E.default,validateOnChange:!1},(e=>{let{handleSubmit:a,values:r,errors:d,handleChange:f,handleBlur:g}=e;return l.default.createElement("form",{onSubmit:a},l.default.createElement(l.default.Fragment,null,l.default.createElement(s.HeaderLayout,{primaryAction:l.default.createElement(c.Stack,{horizontal:!0,spacing:2},l.default.createElement(u.Button,{disabled:"strapi-super-admin"===_.code,onClick:a,loading:n,size:"L"},t({id:"global.save",defaultMessage:"Save"}))),title:t({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:l.default.createElement(p.Link,{startIcon:l.default.createElement(m.default,null),to:"/settings/roles"},t({id:"global.back",defaultMessage:"Back"}))}),l.default.createElement(s.ContentLayout,null,l.default.createElement(c.Stack,{spacing:6},l.default.createElement(v.RoleForm,{isLoading:C,disabled:L,errors:d,values:r,onChange:f,onBlur:g,role:_}),k||C?l.default.createElement(i.Box,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},l.default.createElement(o.LoadingIndicatorPage,null)):l.default.createElement(i.Box,{shadow:"filterShadow",hasRadius:!0},l.default.createElement(v.Permissions,{isFormDisabled:L,permissions:B,ref:P,layout:S}))))))})))};t.default=P},88245:function(e,t,a){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=l(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}r.default=e,a&&a.set(e,r);return r}(a(53209)),n=a(68547);function l(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(l=function(e){return e?a:t})(e)}var o=r.object().shape({name:r.string().required(n.translatedErrors.required)});t.default=o},19144:function(e,t,a){var r=a(95318);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var a=s(t);if(a&&a.has(e))return a.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var o=n?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(r,l,o):r[l]=e[l]}r.default=e,a&&a.set(e,r);return r}(a(53547)),l=a(68547),o=a(39711),i=r(a(13240)),u=r(a(46781));function s(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,a=new WeakMap;return(s=function(e){return e?a:t})(e)}var d=()=>{const e=(0,n.useMemo)((()=>({read:i.default.settings.roles.read,update:i.default.settings.roles.update})),[]),{isLoading:t,allowedActions:{canRead:a,canUpdate:r}}=(0,l.useRBAC)(e);return t?n.default.createElement(l.LoadingIndicatorPage,null):a||r?n.default.createElement(u.default,null):n.default.createElement(o.Redirect,{to:"/"})};t.default=d}}]);